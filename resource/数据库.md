# 数据库

# mysql

## 1.事务的ACID和隔离性

### 1.ACID

原子性(Atomic)：事务是一个不可分割的单位，事务中各项操作，要么全成功要么失败回滚。这个主要是通过undolog日志保证。
一致性(Consistent)：事务执行前后，数据会从**一个合法性状态**进入到**另一个合法性状态**。通过undolog保证
隔离性(Isolated)：并发执行的事务彼此无法看到对方的中间状态；通过锁来实现。
持久性(Durable)：事务完成后所做的改动都会被持久化，即使发生灾难性的失败。通过日志和同步备份可以在故障发生后重建数据。通过redolog实现。

### 2.隔离级别

<img src="C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20220318172749364.png" alt="image-20220318172749364" style="zoom: 33%;" />

## 2.执行流程和引擎

<img src="C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20220318153224330.png" alt="image-20220318153224330" style="zoom: 50%;" />

<img src="C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20220318153524376.png" alt="image-20220318153524376" style="zoom:50%;" />

## 3.索引设计原则

### 适合做索引

**1.频繁where的，经常group by 和 order by和经常distinct的**

**2.散列度高的**

### 全表选择度

select count(distinct address) / count(*) from shop;

### 不适合做索引

**1.数据量小的表**

**2.大量重复数据的列**

**3.经常更新的创建过多的索引**



## 4.数据库服务器调优

### 1.调优流程图

<img src="C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20220315141829729.png" alt="image-20220315141829729" style="zoom: 25%;" />

### 2.使用慢查询调优

SHOW [GLOBAL|SESSION] STATUS LIKE 'Slow_queries';//慢查询的次数

show variables like '%long_query_time%';                        //查询参数

1.开启慢查询日志、设置慢查询阈值





## 5.数据库设计的原则

1.主键一定要设置为递增，防止页面分裂和记录移动。

2.小表驱动大表



## 6.存储引擎

![image-20220318164107447](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20220318164107447.png)

## 7.专有名词

1.FileSort 排序  文件排序

2.单路排序 （快）（fileSort算法）
从磁盘读取查询需要的 所有列 放在BUFFER，按照order by列在buffer对它们进行排序。

3.覆盖索引

一个索引包含满足查询结果的列。（简单说就是， 索引列+主键 包含 SELECT 到 FROM之间查询的列 。）

4.索引下推（ICP）

先把符合条件的非聚簇索引页里的数据收集起来，  减少回表次数，





## 1.SQL 语句在 MySQL 中的流程是： 

#### **SQL语句→连接层→查询缓存→解析器→优化器→执行器** 

![image-20220321151203184](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20220321151203184.png)

## 2.数据库缓冲池(buffer pool)：

**DBMS 会申请 占用内存来作为数据缓冲池 ，在真正访问页面之前，需要把在磁盘上的页缓存到内存中的 Buffer Pool 之后才可以访问。**

## 3.Innodb和myIsam区别

**1.外键、支持事务、索引是否保存数据(myisam 叶子节点的data域存放的是 数据记录的地址)、是否支持表锁。**

## 4.索引基本结构

**1.页默认大小是16KB**

## 5.慢查询日志

```
开启日志：mysql > set global slow_query_log='ON';

设置时间阈值（长查询时间）：set global long_query_time = 1;

分析工具mysqldyumplow#得到返回记录集最多的10个SQL：
mysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log
```

## 6.EXPLAIN各列作用

type、key、key_len